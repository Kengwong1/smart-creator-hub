import streamlit as st
import os
from dotenv import load_dotenv
import google.generativeai as genai

# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÇ‡∏õ‡∏£
st.set_page_config(page_title="Smart Creator Hub", page_icon="üé¨", layout="wide")

# 2. ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
load_dotenv()
api_key = os.getenv("GEMINI_API_KEY")

if not api_key:
    st.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö API Key! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Å‡πÑ‡∏ü‡∏•‡πå .env ‡∏ô‡∏∞‡∏Ñ‡∏∞")
    st.stop()

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ AI (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ü‡∏£‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
genai.configure(api_key=api_key)
model = genai.GenerativeModel('gemini-flash-latest')

# --- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á Sidebar (‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢) ---
with st.sidebar:
    st.image("https://cdn-icons-png.flaticon.com/512/1998/1998342.png", width=100)
    st.title("‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô")
    menu = st.radio(
        "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:",
        ["üé¨ ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏Ñ‡∏•‡∏¥‡∏õ", "üí∞ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á"]
    )
    st.divider()
    st.caption("Smart Creator Hub v1.0")

# --- ‡πÇ‡∏ã‡∏ô 1: ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå (Script Generator) ---
if menu == "üé¨ ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏Ñ‡∏•‡∏¥‡∏õ":
    st.title("üé¨ ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå TikTok/Reels")
    st.info("üí° ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ‡∏™‡∏≤‡∏¢‡∏£‡∏µ‡∏ß‡∏¥‡∏ß, ‡∏™‡∏≤‡∏¢‡∏Æ‡∏≤, ‡∏™‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ")

    col1, col2 = st.columns(2)
    with col1:
        product_name = st.text_input("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞, ‡∏Ñ‡∏£‡∏µ‡∏°‡∏Å‡∏±‡∏ô‡πÅ‡∏î‡∏î")
    with col2:
        mood = st.selectbox("‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏õ?", ["‡∏ï‡∏•‡∏Å/‡∏Å‡∏ß‡∏ô‡πÜ", "‡∏î‡∏£‡∏≤‡∏°‡πà‡∏≤/‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á", "‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á/‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç", "ASMR/‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢"])

    if st.button("‚ú® ‡πÄ‡∏™‡∏Å‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏Ñ‡∏•‡∏¥‡∏õ"):
        if not product_name:
            st.warning("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏Ñ‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏û‡∏µ‡πà!")
        else:
            with st.spinner("AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏•‡∏∞‡∏Ñ‡∏£..."):
                prompt = f"""
                ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏™‡∏±‡πâ‡∏ô (TikTok) ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: {product_name}
                ‡∏™‡πÑ‡∏ï‡∏•‡πå: {mood}
                ‡∏Ç‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á:
                1. HOOK (3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πâ‡∏ß‡πÇ‡∏õ‡πâ‡∏á‡∏Ñ‡∏ô‡∏î‡∏π)
                2. ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏â‡∏≤‡∏Å‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢)
                3. CTA (‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤/‡∏Å‡∏î‡πÑ‡∏•‡∏Å‡πå)
                ‡∏Ç‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏û‡∏π‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô‡∏ä‡∏≠‡∏ö
                """
                try:
                    response = model.generate_content(prompt)
                    st.success("‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≥‡∏à‡πâ‡∏≤ üëá")
                    st.markdown(response.text)
                except Exception as e:
                    st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")

# --- ‡πÇ‡∏ã‡∏ô 2: ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á (Affiliate Copywriter) ---
elif menu == "üí∞ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á":
    st.title("üí∞ ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤ (Affiliate)")
    st.info("üí° ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ‡πÅ‡∏õ‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå Shopee/Lazada ‡πÉ‡∏ô Facebook/Twitter")

    product_detail = st.text_area("‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ", height=100, 
                                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏±‡∏î‡∏•‡∏°‡∏û‡∏Å‡∏û‡∏≤ ‡∏•‡∏°‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å ‡πÅ‡∏ö‡∏ï‡∏≠‡∏∂‡∏î 10 ‡∏ä‡∏°. ‡∏°‡∏µ‡∏™‡∏≤‡∏¢‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Ñ‡∏≠")
    platform = st.selectbox("‡∏à‡∏∞‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?", ["Facebook (‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)", "Twitter (‡πÄ‡∏ô‡πâ‡∏ô‡∏™‡∏±‡πâ‡∏ô‡πÜ+‡∏ï‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏Å)", "Instagram (‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥)"])

    if st.button("üí∏ ‡πÄ‡∏™‡∏Å‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á"):
        if not product_detail:
            st.warning("‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏à‡πâ‡∏≤")
        else:
            with st.spinner("AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡∏ã‡∏∑‡πâ‡∏≠..."):
                prompt = f"""
                ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á (Sales Copywriting) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡∏á {platform}
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: {product_detail}
                
                ‡πÇ‡∏à‡∏ó‡∏¢‡πå:
                - ‡∏Ç‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà "‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤‡πÅ‡∏£‡∏á‡πÜ" ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡∏≤‡∏Å‡∏Å‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                - ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Pain Point)
                - ‡πÉ‡∏™‡πà Emoji ‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å
                - ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå (Call to Action)
                - ‡∏Ç‡∏≠ Hashtag ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 5 ‡∏≠‡∏±‡∏ô
                """
                try:
                    response = model.generate_content(prompt)
                    st.success("‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏π‡∏î‡∏ï‡∏±‡∏á‡∏Ñ‡πå‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß! üëá")
                    st.code(response.text, language=None) # ‡πÉ‡∏ä‡πâ st.code ‡πÉ‡∏´‡πâ‡∏Å‡πä‡∏≠‡∏õ‡∏á‡πà‡∏≤‡∏¢‡πÜ
                except Exception as e:
                    st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")